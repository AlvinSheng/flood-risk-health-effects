---
title: "Analysis before fitting the CAR model"
author: "Alvin Sheng"
date: "6/28/2021"
output: pdf_document
---

```{r}
library(here)
library(ape)
library(GGally)
```

```{r}
fls_model_df <- readRDS(here("intermediary_data/fls_model_df.rds"))
```

# Checking for multicollinearity among the covariates

`S.CARleroux()` automatically puts a fixed ridge penalty on the beta coefficients. Therefore, the large number of covariates and multicollinearity would be accounted for. 

## Flood risk variables

```{r}
ggcorr(data = fls_model_df[, c(17:38, 63)], progress = F)
```

```{r}
flood_cor <- cor(fls_model_df[complete.cases(fls_model_df[, c(17:38, 63)]), c(17:38, 63)])

flood_cor[nrow(flood_cor), ]
```

For each variable, I take the summary of its correlations with other variables, not including itself. 

```{r}
diag(flood_cor) <- NA

summary(flood_cor)
```

Many of the flood risk variables are very correlated.

## SVI Variables

```{r}
ggcorr(data = fls_model_df[, 39:54], progress = F)
```

```{r}
(svi_cor <- cor(fls_model_df[complete.cases(fls_model_df[, 39:54]), 39:54]))
```

```{r}
diag(svi_cor) <- NA

summary(svi_cor)
```



## Air pollution variables

```{r}
ggpairs(data = fls_model_df, columns = 55:60, progress = F)
```



## Smoking prevalence variables

```{r}
ggpairs(data = fls_model_df, columns = 61:62, progress = F)
```

The correlation between total_mean and daily_mean is almost one. 



# Non-spatial modeling

```{r}
Y <- fls_model_df$`Life expectancy, 2014*`

# extract the covariates matrix

X <- fls_model_df[, 17:(ncol(fls_model_df) - 1)]

X           <- scale(X) # Scale covariates
X[is.na(X)] <- 0        # Fill in missing values with the mean
```

```{r}
fls_lm <- lm(Y ~ X)
```

```{r}
summary(fls_lm)
```



# Checking for spatial autocorrelation

```{r}
W <- readRDS(here("intermediary_data", "countyadj_reorganize.rds"))
```

Moran's I

```{r}
(moran_results <- Moran.I(residuals(fls_lm), W))
```

The *p*-value is negligible, so we can reject the null hypothesis of zero spatial autocorrelation. Since the observed value of I is significantly greater then the expected value, the life expectancies are positively autocorrelated, in contrast to negatively autocorrelated. Thus, using a CAR model is justified. 





